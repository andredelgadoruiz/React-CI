name: CI/CD

on:
  push:
    branches:
      - main
  pull_request:
    branches: [main]
    types: [opened, synchronize]
  
jobs:
  
  # avoid_reduncy:
  #   runs-on: ubuntu-18.04
  #   steps:
  #     - name: Cancel previous redundand builds
  #       uses: styfle/cancel-workflow-action@0.9.1
  #       with:
  #         access_token: ${{ github.token }}

  # lint:
  #   runs-on: ubuntu-18.04
  #   steps:
  #     - uses: actions/checkout@v3
  #       with:
  #         fetch-depth: 0
  #     - uses: actions/setup-node@v3
  #       with:
  #         node-version: 14
  #     - name: Install dependencies
  #       run: npm ci
  #     - name: Lint
  #       run: npm run eslint


  # build:
  #   runs-on: ubuntu-18.04
  #   steps:
  #     - uses: actions/checkout@v3
  #       with:
  #         fetch-depth: 0
  #     - uses: actions/setup-node@v3
  #       with:
  #         node-version: 14
  #     - name: Install dependencies
  #       run: npm ci
  #     - name: Build
  #       run: npm run build
  #     - uses: actions/upload-artifact@v2
  #       with:
  #         name: dist
  #         path: dist



  newrelic:
    runs-on: ubuntu-latest
    steps:
    - run: |
       curl -X POST 'https://api.newrelic.com/v2/applications/${{ secrets.NEW_RELIC_ACCOUNT_ID }}/deployments.json' \
            -H 'X-Api-Key:${{ secrets.NEW_RELIC_INSIGHTS_KEY }}' -i \
            -H 'Content-Type: application/json' \
            -d \
        '{
          "deployment": {
            "revision": "${{ secrets.NEW_RELIC_APPLICATION_ID }}",
            "changelog": "Si",
            "description": "Regular",
            "user": "Daniel"
          }
        }'
